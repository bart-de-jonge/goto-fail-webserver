<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../colors.html">

<dom-module id="coupling-element">
    <template>
        <style include="iron-flex iron-flex-alignment"></style>
        <style>
            :host {
                padding: 32px;
                display: block;
            }

            paper-card {
                display: block;
                background-color: white;
                margin: 0 auto 32px;
                width: 800px;
            }
            
            paper-button {
                color: var(--secondary-color-500);
            }

            .content {
                padding: 16px;
            }

            h2 {
                font-size: 24px;
                font-weight: 400; 
            }

            span {
                color: grey;
            }
            
            .title {
                margin: 0 0 16px;
            }

            .tag {
                font-weight: 500;
            }
        </style>

        <iron-ajax
            auto
            url="/cameras"
            handle-as="json"
            on-response="onGetCameras"></iron-ajax>

        <iron-ajax
            auto
            url="/benine/cameras"
            handle-as="json"
            on-response="onGetRemoteCameras"></iron-ajax>

        <template is="dom-repeat" items="{{cameras}}">
            <paper-card>
                <div class="content">
                    <div class="title">
                        <h2>{{item.name}}</h2>
                        <span>{{item.description}}</span>
                    </div>
                    <paper-item class="layout horizontal justified">
                        <div class="tag">
                            Current camera:
                        </div>
                        <div>
                            {{_getRemoteCamera(item.id)}}
                        </div>
                    </paper-item>
                    <!-- <template is="dom-repeat" items="{{remoteCameras}}">
                        <div>
                            {{item.id}}
                            {{item.address}}
                        </div>
                    </template> -->
                </div>
                <div class="card-actions layout horizontal end-justified">
                    <paper-button raised>edit</paper-button>
                </div>
            </paper-card>
        </template>

   </template>

    <script>
        (function () {
            class couplingElement {
                beforeRegister() {
                    this.is = "coupling-element";

                    this.properties = {
                        cameras: Array,
                        remoteCameras: {
                            type: Object,
                            value: function() {
                                return [];
                            }
                        }
                    };
                }

                _getRemoteCamera(id) {
                    if (id <= -1) {
                        return "No remote camera specified";
                    }
                    const remoteCamera = this.remoteCameras.find((camera) => camera.id === id);
                    console.log(remoteCamera);
                    if (!remoteCamera)  {
                        return "Remote camera not found!";
                    }
                    return remoteCamera.address;
                }

                onGetCameras(event) {
                    console.log(event.detail.response.object);
                    this.cameras = event.detail.response.object;
                }

                onGetRemoteCameras(event) {
                    console.log(event.detail.response.cameras);
                    this.remoteCameras = event.detail.response.cameras;
                }

            }

            Polymer(couplingElement);
        })();
    </script>
</dom-module>
